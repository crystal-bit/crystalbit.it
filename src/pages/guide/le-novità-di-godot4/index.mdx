---
title: "Le novit√† di Godot 4"
layout: "@layouts/Guide.astro"
creationDate: 2022-02-28
updateDate: 2022-09-18
id: 3
draft: false
tags: [Godot Engine 4]
---

import { Image, Picture } from "@astrojs/image/components";
import thumb from "./thumb.png";
import imgServer from "./img/download-server.png";
import imgPixelArtPreset from "./img/pixel-art-preset.png";
import imgGodot4NewProject from "./img/godot4-new-project.png";
import YoutubeEmbed from "@components/YoutubeEmbed.astro";

---

Di recente sta crescendo l‚Äôinteresse verso Godot Engine 4. Ho raccolto qui tutte
le informazioni pi√π utili per chi sta valutando l'utilizzo di questo engine open
source.

<Image src={import("./img/godot4-editor.png")} />

L'ultima versione disponibile √® **Godot Engine 4 Beta** (al tempo della
scrittura di questa guida).

Potete trovare le build ufficiali a questo link:
[downloads.tuxfamily.org/godotengine/4.0/](https://downloads.tuxfamily.org/godotengine/4.0/)

<Image src={imgServer} />

Da qui in avanti utilizzeremo questi nomi per brevit√†:

- con _Godot 4_ intender√≤ _Godot 4 Beta_
- con _Godot 3_ mi riferir√≤ invece all'ultima versione stabile di Godot 3, che
  al tempo della scrittura √® Godot 3.5

## Stabilit√† dell‚Äôengine

<Image
  width={500}
  aspectRatio={16 / 9}
  src="https://godotengine.org/storage/app/uploads/public/5e3/0a6/083/5e30a6083a68f545209322.png"
/>

**Godot 4 √® ormai in feature freeze, quindi il focus dello sviluppo √® nel
migliorare le performance e rimuovere tutti i bug**. Potrebbero esserci dei
piccoli cambi di API e qualche piccola miglioria ritenuta importante per
l'engine. Storicamente √® capitato di vedere alcune feature anche nelle fasi di
sviluppo pi√π avanzate come la fase RC, quindi aspettiamoci ancora qualche
piccola sorpresa!

Attualmente Godot 4 √® utilizzabile senza grossi limiti, ma l'esperienza non √® ancora rifinita
come lo era per Godot 3. Personalmente la cosa che trovo pi√π fastidiosa attualmente √® la presenza
di un leggero lag nell'utilizzare l'editor. Non ho ancora capito se √® un problema comune o se
avviene solo su particolari configurazioni (magari il compositor di Gnome crea qualche problemino?).

Se volete massima solidit√† per sviluppare un vostro gioco allora vi consiglio di
usare Godot 3 ancora per qualche tempo.

Se invece siete proprio curiosi di cominciare a sviluppare con Godot 4, potete dare un'occhiata
al video tutorial completo fatto qualche tempo fa con la versione alpha.

<YoutubeEmbed videoId="uRzloUV0v0Y" />

## Upgrade da Godot 3 a Godot 4

Se volete aggiornare un progetto dalla versione 3 alla 4, potete semplicemente
aprire un vostro vecchio progetto e l'engine vi mostrer√† l'opzione per fare
l'upgrade.

<Image
  src={import("./img/3to4.png")}
  alt="Screenshot del tool per aggiornare il progetto da Godot 3 a Godot 4"
/>

> √à possibile utilizzare il convertitore
> ufficiale anche da riga di comando ([PR](https://github.com/godotengine/godot/pull/51950)) usando il parametro `--convert-3to4`.

Non vi aspettate che la conversione funzioni magicamente, il tool fa il suo
meglio ma ci saranno diverse cose che andranno aggiustate manualmente per
tornare ad avere un progetto pulito e senza errori.

Ho provato questa soluzione con
[Defending Todot](https://github.com/crystal-bit/defending-todot) ed i problemi
sono stati diversi: preload rotto, Tween non pi√π utilizzabili, export di
variabili non funzionanti, shadowing di variabili gi√† definite. Nonostante
questo, correggere manualmente le prime due scene di gioco (il men√π e la
selezione del livello) mi ha impegnato per circa un'ora. Certamente un buon
risultato, considerando che ancora **non esiste una guida ufficiale per il
porting**, quindi dovrete essere voi a capire come risolvere i singoli errori.

Potrebbe esserne rilasciata una ufficiale in futuro, ma non prima della fase Release Candidate
(fonte:
[godot-docs/issues/4960](https://github.com/godotengine/godot-docs/issues/4960#issuecomment-1230557397)).
Qui trovate comunque delle note non ufficiali che potrebbero aiutarvi: [Unofficial Godot 4.0
Migration/Upgrade
guide](https://gist.github.com/WolfgangSenff/168cb0cbd486c8c9cd507f232165b976)

## Nodi

Molti nodi sono stati aggiornati con un suffisso esplicito per rendere chiara
l'appartenenza al 2D o 3D.

Ad esempio: ora i nodi per gestire le sprite si chiamano `Sprite2D` e `Sprite3D`.

Grazie alla funzionalit√† "Scene Unique Nodes" √® ora possibile utilizzare
`get_node("%NodoUnico")` per accedere ai nodi che sono stati marcati come unici
all'interno della scena.

## Renderer Vulkan/OpenGL

Una delle principali novit√† di Godot 4 √® la riscrittura del motore grafico.
Le librerie utilizzate saranno **Vulkan** ed OpenGL ES 3.0.

Vulkan √® uno standard (open) per computer grafica moderna. Rispetto ad OpenGL,
offre pi√π controllo sulla GPU e quindi migliori performance.

<img src="https://godotengine.org/storage/app/uploads/public/5da/233/dd4/5da233dd4d90a731626797.gif" />

Il renderer viene offerto nelle modalit√† `Clustered` e `Mobile`. Il primo per
una grafica pi√π avanzata, il secondo per applicazioni pi√π semplici.

Non solo, Juan ha parlato anche di altre soluzioni che vorrebbe implementare nella
versione 4.1
([fonte](https://twitter.com/reduzio/status/1568555288910774273?s=20&t=DnhjJkMnamKLRaM7LvxJ4A)).

<Image src={imgGodot4NewProject} />

Tra le altre novit√† troviamo la compilazione degli shader in multi-threading e la
possibilit√† di importare shader GLSL4.50 (con estensioni Vulkan). Notizia che
far√† felice gli utilizzatori di Shadertoy!

Inoltre, a differenza di Godot 3, gli shader sono compilati (e memorizzati in
cache) al caricamento. Questo meccanismo riduerr√† lo stutter nelle prime fasi di
avvio di una scena di gioco. Problema che in passato era comune sia nei giochi
2D che 3D.

<video
  src="https://godotengine.org/storage/app/media/antialias.mp4"
  muted
  autoplay
  controls
/>

Il nuovo renderer migliora:

- Subsurface scattering
- Screen space reflection
- Screen space ambient occlusion (SSAO)
- MSAA, FXAA e Specular anti-aliasing
- Glow/bloom
- Depth of field

<img src="https://godotengine.org/storage/app/uploads/public/5db/e1d/ed1/5dbe1ded186e6248184679.gif" />

Altre funzionalit√† introdotte sono:

- Global Illumination (grazie al contributo di Matias Goldberg di Ogre3D)
  - con supporto ad oggetti dinamici
  - i cambiamenti di luce, posizione e parametri avranno impatto immediato sulla scena
- Soft shadows
- [Volumetric Fog](https://github.com/godotengine/godot/pull/41213)
- Sky shader
- [Decals](https://github.com/godotengine/godot/pull/37861)
- Light projectors
- Sistemi particellari su GPU con attractor, trail, collisioni, sub-emitter
- Generazione automatica delle mesh [LOD](https://github.com/godotengine/godot/pull/44468)
- [VisibilityRange](https://github.com/godotengine/godot/pull/48847)
- [Occlusion culling](https://github.com/godotengine/godot/pull/48050)
- [AMD FidelityFx Super Resolution](https://github.com/godotengine/godot/pull/51679)
- Supporto a finestre multiple per la stessa applicazione/gioco

<video
  src="https://godotengine.org/storage/app/media/4.0/beta1/vshaders-butterflies.mp4?1"
  autoplay
  controls
  muted
/>

Esiste una serie di blog post ufficiali per approfondire il lavoro fatto sul
motore di rendering, lo trovate su
[godotengine.org/article/vulkan-progress-report-1](https://godotengine.org/article/vulkan-progress-report-1).

## Giochi 2D e Pixel Art

Se sviluppate giochi in pixel arte sapete bene che √® necessario disabilitare il filtro texture
per evitare "smarmellamenti" dei propri pixel. In Godot 4 questa impostazione
√® possibile specificarla per ciascun Nodo di tipo CanvasItem che inserite nella vostra scena, tenendo a mente che:

- I nodi figli erediteranno l'impostazione del nodo padre.
- se volete utilizzare un certo filtro per tutte le scene, potete selezionare direttamente l'opzione dai Project Settings come mostrato in [questa parte del tutorial](https://youtu.be/uRzloUV0v0Y?t=587).

Molto utile anche l'aggiunta di classi specifiche per numeri interi come `Vector2i`, `Rect2i`, `Vector3i`.

<Image src={imgPixelArtPreset} />

## üìù GDScript

> üî® Questa sezione √® ancora in lavorazione.

GDScript √® il principale linguaggio di scripting di Godot Engine, la sua sintassi √® simile a quella di Python e Lua.

In Godot 4 √® stato migliorato notevolmente, senza stravolgere la sintassi per
l'utente: chi ha confidenza con Godot 3, si sentir√† a suo agio nell'utilizzare
Godot 4.

Potete seguire tutte le novit√† leggendo
[questi progress report](https://godotengine.org/article/gdscript-progress-report-writing-tokenizer)
ufficiali.

In breve:

- lo _static typing_, quando presente, migliorer√† le performance di esecuzione
  ([ne ho parlato in questo video](https://youtu.be/AWThTxbHibs))
- la parola chiave `await` rimpiazza `yield`
- aggiunta la parola chiave `super` al posto di `.`
- i tipi enumerativi potranno essere usati come tipo di una variabile (in
  passato era gi√† possibile farne l'export)
- sono stati aggiunti gli array tipizzati `var my_array: Array[int] = [1, 2, 3]`
- sono state aggiunte le funzioni lambda, e le funzioni sono diventate un
  _"first class citizen"_ grazie alla classe `Callable`.

```gdscript
func _ready():
  var my_lambda = func(x):
      print(x)
  # my_lamba √® di tipo Callable
  my_lambda.call("hello")
```

- grazie ai `Callable`, Godot permette un approccio funzionale alla
  programmazione. Se volete approfondire vi consiglio questo talk di Geroge
  Marques (principale maintainer di GDScript): [Functional programming and
  applications on GDScript](https://youtu.be/uCnZ0aL0OwQ)
- √® possibile usare l'operatore `match` per eseguire rami di codice in base
  al tipo del parametro
- √® stato aggiunto un sistema di annotazioni, che si distinguono dal simbolo
  `@`. Ad esempio: `@master`, `@puppet`, `@remote`
- anche gli export sono annotazioni: `@export var my_number: int`
- `setget` √® stato rimpiazzato dalle _properties_
  > unlike setget properties always call their setter/getter even inside the
  > same class. This gives users a consistent behavior which won't cause
  > confusion or lead to potential mistakes during a refactor.
- ora √® possibile generare automaticamente documentazione navigabile per i
  propri nodi

## C# / Mono

Godot 4 supporta .NET 6 ([pr](https://github.com/godotengine/godot/pull/64089)).

La versione finale di Godot 4 avr√† supporto sia a GDScript che C#. Non sar√† quindi
necessario avere 2 versioni separate (una GDScript-only e l'altra con supporto a C#).

{/* ## Multiplayer */}

## Fisica, Animazioni, IA e Multiplayer

...

## Documentazione

La documentazione per Godot 4 la potete trovare selezionando la versione
‚Äúlatest‚Äù dal sito ufficiale. Il link esatto √® questo
https://docs.godotengine.org/en/latest/

Purtroppo la documentazione potrebbe contenere alcune pagine che ancora non sono
state aggiornate alla versione 4. Per controllare se la documentazione √® valida vi
consiglio di sfruttare le community Crystal Bit e Godot Engine Italia (o anche quella
internazionale) per chiedere aiuto.

Se invece volete controllare in autonomia, vi spiego quello che faccio di
solito: guardate in alto a destra in qualsiasi pagina della documentazione:
cliccate sul pulsante ‚ÄúEdit on GitHub‚Äù e vi si aprir√† il codice sorgente della
pagina di documentazione. Cliccate su ‚ÄúHistory‚Äù (sempre in alto a destra) e
troverete la lista delle modifiche che sono state fatte su quella pagina.  
Leggendo la descrizione del commit e la loro data, potrete intuire se la pagina
√® aggiornata o meno.

## üÜï Altre Novit√†

Questa guida non √® sufficiente? Se volete una lettura approfondita e completa,
fate riferimento al
[CHANGELOG](https://github.com/godotengine/godot/blob/master/CHANGELOG.md)
ufficiale.

Se vuoi sapere quando nuove versioni di questa guida saranno disponibili, segui
il [canale Telegram](https://t.me/crystalbit) Crystal Bit!

{/* Cose mancanti: motore fisico, nodo tilemap, shaders */}
